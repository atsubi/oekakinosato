#!/root/.rbenv/shims/ruby
# -*- coding: utf-8 -*-

#スタートボタンを押したプレイヤのステートを変更する 1 => 2


require 'cgi'

p_file = "entry.dat" #アクセス状況監視ファイル
pn_file = "entry_name.dat" #アクセスしている名前の一覧

p = cgi['id']
pHash = Hash.new
m = Mutex.new

puts "#{p}"

m.synchronize {

  #アクセステーブル読み込み
  File.open( p_file, "r" ) do |f|
    f.each do |line|
      tmp = line.split(",")
      pHash[tmp[0].strip.to_i] = tmp[1].strip.to_i
    end
  end

  #アクセスフラグを立てる
  if pHash[p] == 1 then
    pHash[p] = 2
  else
    exit(10)
  end

  #アクセステーブル読み込み
  fp = open( p_file, "w" )
  pHash.each{ |pl, state|
    fp.print "#{pl},#{state}"
  }
  fp.close


}

#四人ともアクセスが来るまで待機
#loop do

#  File.open( p_file, "r" ) do |f|
#    f.each do |line|
#      tmp = line.split(",")
#      pHash[tmp[0].strip.to_i] = tmp[1].strip.to_i
#    end
#  end

#  if pHash.select{ |key, value|
#      value == 1
#    }.empty? then 
#    break;
#  end

#end

#お題を決めるスクリプト実行


#誰が回答者か出題者かを決めるスクリプト実行

#ページ移動
#print "Location: http://v157-7-113-64.z1d13.static.cnode.jp/base_Q.html"

#exit
